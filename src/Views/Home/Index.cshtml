@model List<conectaOng.Models.Entities.Event>
@{
    ViewData["Title"] = "Home Page";
}

<!-- Bootstrap Icons -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">

<div class="container pb-5">
    <div class="row align-items-center">
        <div class="col-md-8">
            <h2 class="display-6 fw-bolder text-left">Conecta ONG</h2>
            <p class="text-left">
                As organizações sem fins lucrativos são essenciais para uma sociedade mais justa, atuando em áreas como educação, saúde, meio ambiente e direitos humanos. Contudo, captar e manter voluntários é um grande desafio que afeta diretamente sua missão social.
            </p>
            <p class="text-left">
                O ConectaOng é uma plataforma que facilita a conexão entre ONGs e voluntários, oferecendo ferramentas práticas para uma gestão eficaz, programas de treinamento e estratégias de engajamento, contribuindo para fortalecer o impacto positivo dessas entidades.
            </p>
        </div>

        <div class="col-md-4 text-center">
            <img src="~/img/homeconecta.png" alt="Imagem Home ConectaONG"
                 class="img-fluid rounded-circle shadow"
                 style="max-width: 200px;" />
        </div>
    </div>

    <h2 class="display-6 fw-bolder text-left mt-4">Voluntários</h2>
    <p class="w-50 text-left">
        As organizações sem fins lucrativos são essenciais para uma sociedade mais justa, atuando em áreas como educação, saúde, meio ambiente e direitos humanos. Contudo, captar e manter voluntários é um grande desafio que afeta diretamente sua missão social.
    </p>
    <p class="w-50 text-left">
        O ConectaOng é uma plataforma que facilita a conexão entre ONGs e voluntários, oferecendo ferramentas práticas para uma gestão eficaz, programas de treinamento e estratégias de engajamento, contribuindo para fortalecer o impacto positivo dessas entidades.
    </p>

    @if (!User.Identity.IsAuthenticated)
    {
        <a class="btn btn-dark" asp-area="" asp-controller="User" asp-action="Add">Cadastrar</a>
    }

    <h2 class="display-6 fw-bolder text-left mt-4">Eventos</h2>
    <p class="w-50 text-left">
        No ConectaOng, acreditamos que eventos fortalecem as relações entre voluntários e organizações, criando uma comunidade engajada e inspiradora. Aqui você encontra a divulgação de eventos promovidos por diversas ONGs, com oportunidades para trocar experiências, adquirir novas habilidades e construir conexões significativas. Confira a agenda, participe dos eventos e faça parte de uma rede comprometida com a transformação social.
    </p>

    <button class="btn btn-dark mb-3" data-bs-toggle="modal" data-bs-target="#eventListModal">Compartilhar um Evento</button>
</div>

<!-- Modal 1: Listagem de Eventos -->
<div class="modal fade" id="eventListModal" tabindex="-1" aria-labelledby="eventListModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content rounded-4 shadow">
            <div class="modal-header">
                <h5 class="modal-title" id="eventListModalLabel">Escolha um Evento para Compartilhar</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>
            <div class="modal-body">
                <ul class="list-group">
                    @foreach (var ev in Model)
                    {
                        <li class="list-group-item list-group-item-action"
                            style="cursor:pointer;"
                            data-event-id="@ev.Id"
                            data-event-title="@ev.Title">
                            @ev.Title
                        </li>
                    }
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- Modal 2: Opções de Compartilhamento -->
<div class="modal fade" id="shareOptionsModal" tabindex="-1" aria-labelledby="shareOptionsModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content rounded-4 shadow">
            <div class="modal-header">
                <h5 class="modal-title" id="shareOptionsModalLabel">Compartilhar o Evento</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>
            <div class="modal-body text-center">
                <p id="selectedEventTitle" class="fw-bold fs-5"></p>
                <p>Escolha uma rede social para compartilhar:</p>

                <a class="btn btn-success m-2" target="_blank" id="whatsappShare">
                    <i class="bi bi-whatsapp"></i> WhatsApp
                </a>
                <a class="btn btn-primary m-2" target="_blank" id="facebookShare">
                    <i class="bi bi-facebook"></i> Facebook
                </a>
                <a class="btn btn-secondary m-2" target="_blank" id="instagramShare">
                    <i class="bi bi-instagram"></i> Instagram
                </a>
            </div>
        </div>
    </div>
</div>

<script>
    document.querySelectorAll('#eventListModal .list-group-item').forEach(item => {
            item.addEventListener('click', function (event) {
            event.preventDefault();

            const eventId = this.getAttribute('data-event-id');
                const eventTitle = this.getAttribute('data-event-title');

                document.getElementById('selectedEventTitle').textContent = eventTitle;

                const fullUrl = `${window.location.origin}/Event/List/${eventId}`;

            document.getElementById("whatsappShare").href =
                    "https://api.whatsapp.com/send?text=" + encodeURIComponent("Confira este evento: " + fullUrl);

            document.getElementById("facebookShare").href =
                    "https://www.facebook.com/sharer/sharer.php?u=" + encodeURIComponent(fullUrl);

            document.getElementById("instagramShare").href =
                "https://www.instagram.com/"; // Instagram não permite links diretos

                var eventListModalEl = document.getElementById('eventListModal');
                var shareOptionsModalEl = document.getElementById('shareOptionsModal');

                var eventListModal = bootstrap.Modal.getInstance(eventListModalEl);
                var shareOptionsModal = bootstrap.Modal.getInstance(shareOptionsModalEl);

                if (!eventListModal) {
                    eventListModal = new bootstrap.Modal(eventListModalEl);
                }
                if (!shareOptionsModal) {
                    shareOptionsModal = new bootstrap.Modal(shareOptionsModalEl);
                }

                const onHidden = function () {
                    shareOptionsModal.show();
                    eventListModalEl.removeEventListener('hidden.bs.modal', onHidden);
                };

                eventListModalEl.addEventListener('hidden.bs.modal', onHidden);

                eventListModal.hide();
            });
        });

        // Remove backdrop após fechar a segunda modal para evitar travamento
        document.getElementById('shareOptionsModal').addEventListener('hidden.bs.modal', () => {
            const backdrops = document.querySelectorAll('.modal-backdrop');
            backdrops.forEach(bd => bd.remove());
        });
</script>
